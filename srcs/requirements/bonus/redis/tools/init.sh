#!/bin/sh

echo "=== Starting REDIS Server Initialization ==="

# Configure Redis
echo "Configuring redis..."
echo "maxmemory 256mb" >> /etc/redis.conf
echo "maxmemory-policy allkeys-lru" >> /etc/redis.conf
sed -i 's/^bind 127.0.0.1/#bind 127.0.0.1/' /etc/redis.conf
echo "✅ redis configuration done!"

# Ensure data persistence
echo "Creating necessary folder and setting ownership..."
mkdir -p /data && chown redis:redis /data
echo "✅ Set up done!"

cat << "EOF"
                                           '                                                  ’                                                                                                                 )`·.           
             '                                   (`·.                    )`·._.·´(        )`·.                         )`·.                                                                        /(      .·´    (           
            (`·.               )\'                 \::`·._)`·.     )\.·´::...  .::)   .·´   ./         (`·.        .·´     )                               (`·.              )\            )\      )  `·._):::.    )        ’'
             )  `·.   .·´( .·´  (     /('     .·´(   )::. ..:::).·´;· --  ´ ´\::.`·.(::...:(’             ) :).·´(_\::. .::`·. )`·.      )\   ’'             )  `·.   .·´( .·´  (     )\ .·´ .:`·.(:;;  --  ' '\:. :(.·´)    )\ 
     .·´( .·´:..::(,(::--  ' '\::.`·._) `·.’  ):..\(;;::--  ´ ´               ’\:::::::...::)  .·´(    .·´::..::::::;;  --  ' '\ .::(_.·´::(   ’'     .·´( .·´:..::(,(::--  ' '\:·´ .·´  (,): --  ' '              \....:::`·.(  (
     );; :--   '               \::....:::::)(::...:/\                          ’¯¯¯¯¯¯/'   )  .:`·.);;.--  ' '               \ ..        `·.       \:::....::::·´         _\’' ):.::/\                        ¯¯¯`·’ ::·´ 
  .·´/\                ,...__ ¯¯¯` ·:·´’  `·:/::::\...:´/        ___________'/      `·:::../\                 ,      ` ·:::.....:::)        )..:::·´      ,..:´:::'/'  `·:/::::\...:´/       ____          \     
  )/:::'\...:´/       /:::::::::::/     /        \::::/::::/        /:::::::::;; --  ´ ´\     ’    )/::::\...:´/       /::::,,      `·:::::·´           `·::/       /::::::::/       \::::/::::/      /::::::::/\         'I’   
   \:::/::::/       /;;::;;´-··´´     /  '         \/;::-'/        /;;::·-  ´ ´         _\    '     \::::/::::/       /:::::::`·.      I/’'                 /       /;;::· ´            \/;::-'/      /::::::::/:::I       ’/    
    '\/;::-'/               ,...::::´/     '             /                      .,.,·:::::'/   ’'       \/;::-'/       /¯¯';:::::/      /        '          /       /                         /I      I¯¯¯¯¯\::'/..-::::/    ’'
         /       ,, -,      \::::::/    '     )`·.    '/         _ ,.,.,·:::::::::::::::/     '            /       /      `·::/      /            (`·.)':/       /             '           /::I       ` * · . ____           
  .·´( '/       /:::/::\      \:· ´         (::..:(.·/         /:::::::::::::::::::--  ´      ’          '/       /.·´(_/(  /      /’               ):./       /                         I:::/`:::·...              /’   '      
_) ::/       '/;;:/::::'\      '\          ’' `·::..'/          `·__:::::· ’\:   .·´             .·´(.·´/       /);; --  ' ´      '/                '\:/       /                  '        I:/::::::::::::·-,       ’/'           
)..::/       /    '\::::::'\      '\              )/`·.                        \(              ’  ) .::/                     .·::´/                  /       /                             ` ·::;;::- ··  ´´      /'         '   
`·:/____ /       '\::::::\____\           /::::::`·._____ ...·::::::/                  `·:/:`·.______ .·::´/:::::/'                 '/,..::·´/                     '  /\¯¯¯¯         ,,  -:::::'/'              
 /::::::::/           '\::::/:::::::/           `·:::::::/::::::::/:::::::::/                 ’   /:::::/:::::::::::/:::'/:::·´'                  '/:::::::/                      '/::::\,,  -::::´´::::::::::::/''               
/::::::::/              '\/:::::::'/     '           `·::/::::::::/::::: ·´´                   ’    `·:/::::::::::::/::::·´''                     /:;:: · ´                        \:::/:::::::::::::::;;::-·´´'                 '
¯¯¯¯¯                 ¯¯¯¯          ’            ¯¯¯¯¯                                     ¯¯¯¯¯¯¯¯¯’'                         ¯                              ’' '\/::::::;;::-· ´´'                           
EOF

# Start redis server
exec redis-server /etc/redis.conf --protected-mode no